# プロジェクトコンテキスト

## 目的

Uniskopeは、インディーハッカーやマイクロSaaS運営者向けのオープンソース・パーソナルファーストSaaSコントロールプレーンです。

**ビジョン**: "Your SaaS, your data, your truth."

目的は決済処理ではなく、以下の**Single Source of Truth (SSOT)** を提供することです：
- サブスクリプション状態
- ユーザー状態
- イベント履歴
- エンタイトルメント（機能利用権限）

## 技術スタック

### Backend
- **言語**: Python 3.11+
- **フレームワーク**: FastAPI
- **ORM**: SQLAlchemy
- **マイグレーション**: Alembic
- **データベース**: PostgreSQL（デフォルト）/ MySQL（オプション）

### Frontend
- **フレームワーク**: React
- **ビルドツール**: Vite
- **UIコンポーネント**: Shadcn/ui
- **スタイリング**: TailwindCSS

### インフラ
- **デプロイ**: Docker Compose、シングルノード
- **APIスタイル**: REST、APIファースト設計

## プロジェクト規約

### コードスタイル

#### Backend (Python)
- Ruff (リンター/フォーマッター)
- 型ヒント必須 (mypy strict)
- Pydanticによるデータバリデーション

#### Frontend (TypeScript/React)
- TypeScript strictモード
- ESLint + Prettier
- 関数コンポーネント + Hooks

### アーキテクチャパターン

- **イベントソーシング**: すべての変更を不変イベントとして記録
- **状態解決**: イベントストリームから現在の状態を導出
- **読み取り重視の最適化**: クエリ用のキャッシュと非正規化
- **冪等性**: すべての操作は冪等でなければならない（event_idベース）

### テスト戦略

- ビジネスロジックのユニットテスト
- APIエンドポイントの統合テスト
- 状態解決のイベントリプレイテスト

### Gitワークフロー

- フィーチャーブランチ
- コンベンショナルコミット（日本語コミットメッセージ）
- PRベースのレビュー

## ドメインコンテキスト

### コアコンセプト

- **イベント**: 決済SaaSからの生Webhookペイロード（不変）
- **ユーザー**: 顧客の内部表現
- **サブスクリプション**: ステータスライフサイクルを持つプラン割り当て
- **エンタイトルメント**: サブスクリプションから導出される機能フラグ

### 状態ライフサイクル

```
イベント → イベントストア → 状態リゾルバー → コアDB → API/ダッシュボード
```

### 対応決済プロバイダー（初期）

- Stripe
- Lemon Squeezy
- Paddle

## 重要な制約

### スコープ内 (v0.1)

- シングルユーザー利用
- ローカルファーストのデータストレージ
- SaaS設定のCRUD
- APIファースト設計

### 明示的な非スコープ (v0.1)

- ❌ 認証・認可（ユーザーアカウントなし、ログインなし、RBACなし）
- ❌ マルチテナンシー（組織なし、テナント分離なし）
- ❌ ホスト型/クラウド機能（SaaSホスティングなし、マネージドバックエンドなし）
- ❌ 高度なUI（分析ダッシュボードなし、リアルタイム更新なし）
- ❌ エンタープライズ機能（監査ログなし、コンプライアンスなし、SSOなし）
- ❌ 決済処理そのもの
- ❌ 税金/VAT/インボイス対応
- ❌ メール配信
- ❌ CRM/サポート管理

## 外部依存

### 決済SaaS Webhook

- Webhook署名検証必須
- 生ペイロードの保存
- 冪等なイベント処理

### セキュリティ

- 管理ダッシュボード: localhostまたはVPNのみ
- スコープ制限付きAPIキー
- Webhook署名検証必須
