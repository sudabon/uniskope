# ダッシュボード

運用可視化のための読み取り専用Webインターフェース。ダッシュボードは現在の状態を表示するが、変更は許可しない。

## ADDED Requirements

### Requirement: 読み取り専用インターフェース

ダッシュボードは、データ変更機能を持たない読み取り専用インターフェースでなければならない（SHALL）。

#### Scenario: 編集コントロールがない
- **WHEN** ダッシュボードがレンダリングされる
- **THEN** 編集、削除、作成ボタンは表示されない
- **AND** データ変更用のフォームは存在しない

#### Scenario: 変更の試みがブロックされる
- **GIVEN** ユーザーがブラウザの開発者ツールでデータを変更しようとする
- **WHEN** リクエストがバックエンドに送信される
- **THEN** リクエストは拒否される（ダッシュボードには書き込みエンドポイントが公開されない）

### Requirement: アクティブユーザー表示

ダッシュボードは、現在アクティブなユーザーの数を表示しなければならない（SHALL）。

#### Scenario: アクティブユーザー数が表示される
- **GIVEN** 42人のユーザーがステータス "active" を持つ
- **WHEN** ダッシュボードがロードされる
- **THEN** アクティブユーザー数に "42" が表示される

#### Scenario: アクティブユーザーがゼロ
- **GIVEN** ステータス "active" のユーザーがいない
- **WHEN** ダッシュボードがロードされる
- **THEN** アクティブユーザー数に "0" が表示される

### Requirement: アクティブサブスクリプション一覧

ダッシュボードは、すべてのアクティブサブスクリプションの一覧を表示しなければならない（SHALL）。

#### Scenario: サブスクリプション一覧が表示される
- **GIVEN** 複数のアクティブサブスクリプションが存在する
- **WHEN** ダッシュボードがロードされる
- **THEN** 各サブスクリプションには以下が表示される：
  - ユーザー識別子
  - プラン名
  - ステータス
  - 開始日
  - プロバイダー

#### Scenario: サブスクリプション一覧が空
- **GIVEN** アクティブサブスクリプションが存在しない
- **WHEN** ダッシュボードがロードされる
- **THEN** 「アクティブなサブスクリプションはありません」メッセージが表示される

#### Scenario: サブスクリプションステータスインジケーター
- **GIVEN** 様々なステータスのサブスクリプションが存在する
- **WHEN** サブスクリプション一覧が表示される
- **THEN** 各ステータスには異なる視覚的インジケーターがある：
  - `active`: 緑
  - `trialing`: 青
  - `past_due`: オレンジ/黄色
  - `canceled`: グレー

### Requirement: 最近のイベントタイムライン

ダッシュボードは、最近のイベントのタイムラインを表示しなければならない（SHALL）。

#### Scenario: イベントタイムラインが表示される
- **GIVEN** イベントストアにイベントが存在する
- **WHEN** ダッシュボードがロードされる
- **THEN** 最新のイベントが時系列順に表示される（最新が最初）
- **AND** 各イベントには以下が表示される：
  - イベントタイプ
  - プロバイダー
  - タイムスタンプ
  - 簡単な概要

#### Scenario: イベント詳細が展開可能
- **GIVEN** タイムライン内のイベント
- **WHEN** ユーザーがイベントをクリックする
- **THEN** 完全なイベント詳細（生ペイロードを含む）を閲覧できる

#### Scenario: デフォルトのイベント制限
- **WHEN** イベントタイムラインがロードされる
- **THEN** デフォルトで最新の50件のイベントが表示される
- **AND** 古いイベント用にページネーションまたは「もっと読み込む」が利用可能

### Requirement: 状態遷移ログ

ダッシュボードは、状態遷移のログを表示しなければならない（SHALL）。

#### Scenario: 遷移ログが表示される
- **GIVEN** 状態遷移が記録されている
- **WHEN** 状態遷移ログが閲覧される
- **THEN** 各遷移には以下が表示される：
  - エンティティタイプ（user, subscription, entitlement）
  - エンティティ識別子
  - 遷移前の状態
  - 遷移後の状態
  - タイムスタンプ
  - トリガーとなったイベントへの参照

#### Scenario: エンティティで遷移をフィルタリング
- **GIVEN** 様々なエンティティの状態遷移が存在する
- **WHEN** ユーザーがエンティティタイプ "subscription" でフィルタリングする
- **THEN** サブスクリプションの状態遷移のみが表示される

### Requirement: ダッシュボードアクセス

ダッシュボードは、localhostまたは設定された信頼されたネットワークからのみアクセス可能でなければならない（SHALL）。

#### Scenario: localhostアクセスが許可される
- **GIVEN** 127.0.0.1からのリクエスト
- **WHEN** ダッシュボードにアクセスされる
- **THEN** ダッシュボードがレンダリングされる

#### Scenario: デフォルトで外部アクセスが拒否される
- **GIVEN** 外部IPアドレスからのリクエスト
- **AND** 信頼されたネットワークが設定されていない
- **WHEN** ダッシュボードにアクセスされる
- **THEN** アクセスはHTTP 403で拒否される

#### Scenario: 信頼されたネットワークアクセス
- **GIVEN** 信頼されたネットワークCIDRが設定されている（例：10.0.0.0/8）
- **AND** そのネットワーク内からリクエストが来る
- **WHEN** ダッシュボードにアクセスされる
- **THEN** ダッシュボードがレンダリングされる

### Requirement: ダッシュボードパフォーマンス

ダッシュボードは、許容可能な時間制限内でロードされなければならない（SHALL）。

#### Scenario: 初期ロード時間
- **GIVEN** 典型的なデータセット（10,000イベント未満、1,000ユーザー未満）
- **WHEN** ダッシュボードがロードされる
- **THEN** 初期ビューは2秒以内にレンダリングされる

#### Scenario: 大規模データセットの処理
- **GIVEN** 大規模データセット（100,000イベント以上）
- **WHEN** ダッシュボードがロードされる
- **THEN** サマリーカウントは素早くロードされる（1秒未満）
- **AND** 詳細リストはパフォーマンスを維持するためにページネーションを使用する
